---
- name: "Check if snap is installed"
  package_facts:
    manager: "auto"

- name: Remove snap functionality
  when: ("'snapd' in ansible_facts.packages") and (enable_snap | default(false))
  block:
  - name: "Disable Snapd Service"
    ansible.builtin.service:
      name: snapd
      state: stopped
      enabled: false

  - name: "Uninstall Snapd"
    when: disable_snapd_uninstall_snapd | bool
    ansible.builtin.apt:
      pkg: snapd
      state: absent
